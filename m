Return-Path: <linux-kernel+bounces-897379-lists+linux-kernel=lfdr.de@vger.kernel.org>
X-Original-To: lists+linux-kernel@lfdr.de
Delivered-To: lists+linux-kernel@lfdr.de
Received: from sv.mirrors.kernel.org (sv.mirrors.kernel.org [139.178.88.99])
	by mail.lfdr.de (Postfix) with ESMTPS id 286CBC52F17
	for <lists+linux-kernel@lfdr.de>; Wed, 12 Nov 2025 16:17:39 +0100 (CET)
Received: from smtp.subspace.kernel.org (relay.kernel.org [52.25.139.140])
	(using TLSv1.2 with cipher ECDHE-ECDSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by sv.mirrors.kernel.org (Postfix) with ESMTPS id 2FFAB5006B9
	for <lists+linux-kernel@lfdr.de>; Wed, 12 Nov 2025 14:23:00 +0000 (UTC)
Received: from localhost.localdomain (localhost.localdomain [127.0.0.1])
	by smtp.subspace.kernel.org (Postfix) with ESMTP id B0C863101B0;
	Wed, 12 Nov 2025 14:21:25 +0000 (UTC)
Authentication-Results: smtp.subspace.kernel.org;
	dkim=pass (2048-bit key) header.d=kernel.org header.i=@kernel.org header.b="S9WMmZ/Q"
Received: from smtp.kernel.org (aws-us-west-2-korg-mail-1.web.codeaurora.org [10.30.226.201])
	(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by smtp.subspace.kernel.org (Postfix) with ESMTPS id 0C0E528B4E2
	for <linux-kernel@vger.kernel.org>; Wed, 12 Nov 2025 14:21:25 +0000 (UTC)
Authentication-Results: smtp.subspace.kernel.org; arc=none smtp.client-ip=10.30.226.201
ARC-Seal:i=1; a=rsa-sha256; d=subspace.kernel.org; s=arc-20240116;
	t=1762957285; cv=none; b=H6acaSTQuGZ9mZEhYUjvBhKH86kg3cCKY3XKvzYc/x4yD++Ls5jU3qkXmd7ElAaZ9a7q3b07EXdxoGL6+Wg0GX+/wC6jTaVrTAAM8wu/37hmr7ziD3AOJ/JNUg0ZvQXzfrH1N93XK2h51qJrRB16q82+UMHNvC4+Z6T9JWgrCeU=
ARC-Message-Signature:i=1; a=rsa-sha256; d=subspace.kernel.org;
	s=arc-20240116; t=1762957285; c=relaxed/simple;
	bh=/hOxQ9C2lk+N1NIFVh7E5xgqEFJaMmpx3AHeuX5+Zpg=;
	h=Date:Message-ID:From:To:Cc:Subject:In-Reply-To:References:
	 MIME-Version:Content-Type; b=JYtPxPh8kj8pX0GLpxZzeffKlzrkn07OEk2oP+G3yXuYjtUbXF2QrC1dkCxi3NxAxP/J/3FpNXbBeY4lEdLQ5Jah1FYT/8Af69SFHGfq9aI8fPHrFdtIyc2DLZbdMScLBSgtXzHbayP3kXvgV4h6uNuqld7lspjJWpjgOzzUZXo=
ARC-Authentication-Results:i=1; smtp.subspace.kernel.org; dkim=pass (2048-bit key) header.d=kernel.org header.i=@kernel.org header.b=S9WMmZ/Q; arc=none smtp.client-ip=10.30.226.201
Received: by smtp.kernel.org (Postfix) with ESMTPSA id DC674C4CEF1;
	Wed, 12 Nov 2025 14:21:24 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=kernel.org;
	s=k20201202; t=1762957284;
	bh=/hOxQ9C2lk+N1NIFVh7E5xgqEFJaMmpx3AHeuX5+Zpg=;
	h=Date:From:To:Cc:Subject:In-Reply-To:References:From;
	b=S9WMmZ/QWOtdikDnydmU61FjwbB33dU661tQCn0LGXCwTDjFjNyMN4nAabSqTbQQX
	 zMofYdpo2BcBxGlJnV5HMtLCFuXnDYQNDvTu+q3mpqyZAvbo+Sa9LV87XW1KeufzDi
	 WwEA2yI09w1qqI0sjrv3ScXYLoi3mo3DpmHIgUyAZaDc1bQUTeDMYjOvsm+QV582zX
	 9ZzC1xGvrofsGKVNhyKWh0TKCfnARAMQfOOjSTtQcx68Gb7/Y0Edk7Funj/6mhQmCo
	 1BzEGBIcLqj6xDaoz8Jjj4bQrLf4sIX8SvgxygQ5cNrDZFl4MMH1XVGaY84pKOr6tF
	 6dYb9u2R7cGrQ==
Received: from sofa.misterjones.org ([185.219.108.64] helo=goblin-girl.misterjones.org)
	by disco-boy.misterjones.org with esmtpsa  (TLS1.3) tls TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
	(Exim 4.98.2)
	(envelope-from <maz@kernel.org>)
	id 1vJBis-00000004Z5y-2Y9g;
	Wed, 12 Nov 2025 14:21:22 +0000
Date: Wed, 12 Nov 2025 14:21:22 +0000
Message-ID: <86v7jftjq5.wl-maz@kernel.org>
From: Marc Zyngier <maz@kernel.org>
To: Breno Leitao <leitao@debian.org>
Cc: catalin.marinas@arm.com,
	will@kernel.org,
	mark.rutland@arm.com,
	paulmck@kernel.org,
	mhiramat@kernel.org,
	linux-arm-kernel@lists.infradead.org,
	linux-kernel@vger.kernel.org,
	kernel-team@meta.com
Subject: Re: arm64: pseudo NMI bootconfig question
In-Reply-To: <rs4igmsjrm6r2aio4nbe5jos3vcqk2u4bjhltjwtj2pn3cquip@kv3grgec7qrb>
References: <rs4igmsjrm6r2aio4nbe5jos3vcqk2u4bjhltjwtj2pn3cquip@kv3grgec7qrb>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI-EPG/1.14.7 (Harue)
 FLIM-LB/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL-LB/10.8 EasyPG/1.0.0 Emacs/30.1
 (aarch64-unknown-linux-gnu) MULE/6.0 (HANACHIRUSATO)
Precedence: bulk
X-Mailing-List: linux-kernel@vger.kernel.org
List-Id: <linux-kernel.vger.kernel.org>
List-Subscribe: <mailto:linux-kernel+subscribe@vger.kernel.org>
List-Unsubscribe: <mailto:linux-kernel+unsubscribe@vger.kernel.org>
MIME-Version: 1.0 (generated by SEMI-EPG 1.14.7 - "Harue")
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable
X-SA-Exim-Connect-IP: 185.219.108.64
X-SA-Exim-Rcpt-To: leitao@debian.org, catalin.marinas@arm.com, will@kernel.org, mark.rutland@arm.com, paulmck@kernel.org, mhiramat@kernel.org, linux-arm-kernel@lists.infradead.org, linux-kernel@vger.kernel.org, kernel-team@meta.com
X-SA-Exim-Mail-From: maz@kernel.org
X-SA-Exim-Scanned: No (on disco-boy.misterjones.org); SAEximRunCond expanded to false

On Wed, 12 Nov 2025 14:05:43 +0000,
Breno Leitao <leitao@debian.org> wrote:
>=20
> Hello,
>=20
> In most major Linux distributions, it=E2=80=99s common to have a separate=
 debug kernel
> build. This variant is compiled with additional debug configuration optio=
ns to
> provide deeper observability and easier debugging, typically at the expen=
se of
> some performance.
>=20
> This approach is also used in several companies, including mine. The debug
> flavor is usually a drop-in replacement deployed when investigating
> issues, allowing quicker identification before more detailed manual
> debugging.
>=20
> I=E2=80=99m currently debugging some hung tasks using the debug kernel fl=
avor and
> noticed that backtraces weren=E2=80=99t printed correctly because PSEUDO =
NMI isn=E2=80=99t
> enabled.
>=20
> AFAIK, to enable PSEUDO NMI on ARM, the following are required:
>=20
>  cmdline: irqchip.gicv3_pseudo_nmi=3D1
>  config: CONFIG_ARM64_PSEUDO_NMI=3Dy
>=20
> I wanted to have pseudo NMI enabled by default in the debug kernel
> (without relying on kernel command-line parameters), but this isn=E2=80=
=99t
> possible today. The reason is that `irqchip.gicv3_pseudo_nmi` is an early
> parameter, which can=E2=80=99t be set through bootconfig, so, independent=
 of my
> .config, I need to hack cmdline arguments to have the debuggability
> I need.
>=20
> Question:
>=20
> Would it make sense to provide an option to enable pseudo NMI in certain
> kernel configuration without requiring an extra command-line parameter?

[I wasn't asked, but I'll give my answer anyway]

The short answer is no. The long answer is that there is so much
broken HW out there that dies a painful death when enabling pseudo-NMI
that is isn't practical to do so. It also brings a measurable
overhead to some of the most frequent operations (interrupt masking).

Until someone weeds out the broken machines (in some cases, by prying
them from my cold dead hands), the requirement for the option is
likely to stick.

Thanks,

	M.

--=20
Without deviation from the norm, progress is not possible.

