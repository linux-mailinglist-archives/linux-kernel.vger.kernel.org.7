Return-Path: <linux-kernel+bounces-683118-lists+linux-kernel=lfdr.de@vger.kernel.org>
X-Original-To: lists+linux-kernel@lfdr.de
Delivered-To: lists+linux-kernel@lfdr.de
Received: from ny.mirrors.kernel.org (ny.mirrors.kernel.org [IPv6:2604:1380:45d1:ec00::1])
	by mail.lfdr.de (Postfix) with ESMTPS id AC8C8AD6936
	for <lists+linux-kernel@lfdr.de>; Thu, 12 Jun 2025 09:36:53 +0200 (CEST)
Received: from smtp.subspace.kernel.org (relay.kernel.org [52.25.139.140])
	(using TLSv1.2 with cipher ECDHE-ECDSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by ny.mirrors.kernel.org (Postfix) with ESMTPS id 44D0017E612
	for <lists+linux-kernel@lfdr.de>; Thu, 12 Jun 2025 07:36:54 +0000 (UTC)
Received: from localhost.localdomain (localhost.localdomain [127.0.0.1])
	by smtp.subspace.kernel.org (Postfix) with ESMTP id 63A4A20FA84;
	Thu, 12 Jun 2025 07:36:48 +0000 (UTC)
Authentication-Results: smtp.subspace.kernel.org;
	dkim=pass (2048-bit key) header.d=kernel.org header.i=@kernel.org header.b="jhXpqvxi"
Received: from smtp.kernel.org (aws-us-west-2-korg-mail-1.web.codeaurora.org [10.30.226.201])
	(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by smtp.subspace.kernel.org (Postfix) with ESMTPS id BF2381C7013;
	Thu, 12 Jun 2025 07:36:47 +0000 (UTC)
Authentication-Results: smtp.subspace.kernel.org; arc=none smtp.client-ip=10.30.226.201
ARC-Seal:i=1; a=rsa-sha256; d=subspace.kernel.org; s=arc-20240116;
	t=1749713807; cv=none; b=c0Cb4cFYOm5Dg8dWQAOC7dfLiISJmnBI18qN0K3TccLVXQkMMwKwzyAg6NBcPlg2yPAnJmu6l93cPZK/X/OY/MdQdZDT94E9vOm5UY7Jv1z6n51IJX37jyL55jVSvYe0HyX7zwyO/2zrk64PQzFivxJ7DGAk68qpXG1tP2U2c9g=
ARC-Message-Signature:i=1; a=rsa-sha256; d=subspace.kernel.org;
	s=arc-20240116; t=1749713807; c=relaxed/simple;
	bh=amK0NIN5f0CVZN6pcqtau63uuJcNZ6OKBSVmWtcbOOA=;
	h=Date:Message-ID:From:To:Cc:Subject:In-Reply-To:References:
	 MIME-Version:Content-Type; b=CXDIjTI+/DjDNof/ipFIB+lCslewEkCEuhf2IujyX0xU0V5tdSou0+YmrgA5CjAJ85UVu4123UhG1rJn2DjckBPjXOaTVCk7setVfvWOwxuVBohVfp0wGKGrhXj9xCF7r7WZRT8KNpZCVvk8Pa5ngrvwjMm4hO6FUvlG54rhSmo=
ARC-Authentication-Results:i=1; smtp.subspace.kernel.org; dkim=pass (2048-bit key) header.d=kernel.org header.i=@kernel.org header.b=jhXpqvxi; arc=none smtp.client-ip=10.30.226.201
Received: by smtp.kernel.org (Postfix) with ESMTPSA id 5916FC4CEEA;
	Thu, 12 Jun 2025 07:36:47 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=kernel.org;
	s=k20201202; t=1749713807;
	bh=amK0NIN5f0CVZN6pcqtau63uuJcNZ6OKBSVmWtcbOOA=;
	h=Date:From:To:Cc:Subject:In-Reply-To:References:From;
	b=jhXpqvxiJ8HB4Z6LoALegW644y4p6iJclaaAexuKW+f1jpZdYSnhGxWdVhO9fWa6y
	 bt4S9aYCno/oHs2YizX0PjYe8k5RuprvhSVJRsd2uD6VjNlJk2YnPxJevAsZARuBqS
	 4+vplqFYaJwis1SM29MD9diaQjEmZo3TVfwYxs25kTS4dheBDVIpO/Y6IvzJ64KrVD
	 WkxjI6O4WLJ12rmZzhuhEGSp8FY4uFPHRwai5fEeXqQ6rW9ay+1gaqpnqHNUHFiVHw
	 HHmSmzB586b0MKLJWjf/2PW4DSIQiSYBUXL9HjA8H6xR0I64kFvIpZLDER8WsTap0A
	 7Y3dA/Y2bImAQ==
Received: from sofa.misterjones.org ([185.219.108.64] helo=goblin-girl.misterjones.org)
	by disco-boy.misterjones.org with esmtpsa  (TLS1.3) tls TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
	(Exim 4.95)
	(envelope-from <maz@kernel.org>)
	id 1uPcUP-0069LT-68;
	Thu, 12 Jun 2025 08:36:45 +0100
Date: Thu, 12 Jun 2025 08:36:44 +0100
Message-ID: <86y0txcsxf.wl-maz@kernel.org>
From: Marc Zyngier <maz@kernel.org>
To: Yeoreum Yun <yeoreum.yun@arm.com>
Cc: catalin.marinas@arm.com,
	pcc@google.com,
	will@kernel.org,
	broonie@kernel.org,
	anshuman.khandual@arm.com,
	joey.gouly@arm.com,
	yury.khrustalev@arm.com,
	oliver.upton@linux.dev,
	frederic@kernel.org,
	akpm@linux-foundation.org,
	surenb@google.com,
	linux-arm-kernel@lists.infradead.org,
	linux-kernel@vger.kernel.org,
	linux-doc@vger.kernel.org
Subject: Re: [PATCH v7 1/9] arm64/cpufeature: add FEAT_MTE_TAGGED_FAR feature
In-Reply-To: <20250611135818.31070-2-yeoreum.yun@arm.com>
References: <20250611135818.31070-1-yeoreum.yun@arm.com>
	<20250611135818.31070-2-yeoreum.yun@arm.com>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI-EPG/1.14.7 (Harue)
 FLIM-LB/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL-LB/10.8 EasyPG/1.0.0 Emacs/30.1
 (aarch64-unknown-linux-gnu) MULE/6.0 (HANACHIRUSATO)
Precedence: bulk
X-Mailing-List: linux-kernel@vger.kernel.org
List-Id: <linux-kernel.vger.kernel.org>
List-Subscribe: <mailto:linux-kernel+subscribe@vger.kernel.org>
List-Unsubscribe: <mailto:linux-kernel+unsubscribe@vger.kernel.org>
MIME-Version: 1.0 (generated by SEMI-EPG 1.14.7 - "Harue")
Content-Type: text/plain; charset=US-ASCII
X-SA-Exim-Connect-IP: 185.219.108.64
X-SA-Exim-Rcpt-To: yeoreum.yun@arm.com, catalin.marinas@arm.com, pcc@google.com, will@kernel.org, broonie@kernel.org, anshuman.khandual@arm.com, joey.gouly@arm.com, yury.khrustalev@arm.com, oliver.upton@linux.dev, frederic@kernel.org, akpm@linux-foundation.org, surenb@google.com, linux-arm-kernel@lists.infradead.org, linux-kernel@vger.kernel.org, linux-doc@vger.kernel.org
X-SA-Exim-Mail-From: maz@kernel.org
X-SA-Exim-Scanned: No (on disco-boy.misterjones.org); SAEximRunCond expanded to false

On Wed, 11 Jun 2025 14:58:10 +0100,
Yeoreum Yun <yeoreum.yun@arm.com> wrote:
> 
> Add FEAT_MTE_TAGGED_FAR cpucap which makes FAR_ELx report
> all non-address bits on a synchronous MTE tag check fault since Armv8.9
> 
> Signed-off-by: Yeoreum Yun <yeoreum.yun@arm.com>
> Acked-by: Yury Khrustalev <yury.khrustalev@arm.com>
> ---
>  arch/arm64/kernel/cpufeature.c | 8 ++++++++
>  arch/arm64/tools/cpucaps       | 1 +
>  2 files changed, 9 insertions(+)
> 
> diff --git a/arch/arm64/kernel/cpufeature.c b/arch/arm64/kernel/cpufeature.c
> index b34044e20128..af6a6924a3e8 100644
> --- a/arch/arm64/kernel/cpufeature.c
> +++ b/arch/arm64/kernel/cpufeature.c
> @@ -320,6 +320,7 @@ static const struct arm64_ftr_bits ftr_id_aa64pfr1[] = {
>  
>  static const struct arm64_ftr_bits ftr_id_aa64pfr2[] = {
>  	ARM64_FTR_BITS(FTR_VISIBLE, FTR_STRICT, FTR_LOWER_SAFE, ID_AA64PFR2_EL1_FPMR_SHIFT, 4, 0),
> +	ARM64_FTR_BITS(FTR_VISIBLE, FTR_NONSTRICT, FTR_LOWER_SAFE, ID_AA64PFR2_EL1_MTEFAR_SHIFT, 4, ID_AA64PFR2_EL1_MTEFAR_NI),
>  	ARM64_FTR_END,
>  };

Same thing as the remark I had on FEAT_LSUI: for anything that does
not introduce extra state, please similarly enable the feature in KVM.
There is no point in these discrepancies.

For anything that has extra state, you should at least consider what
needs to be done.

Thanks,

	M.

-- 
Without deviation from the norm, progress is not possible.

