Return-Path: <linux-kernel+bounces-594501-lists+linux-kernel=lfdr.de@vger.kernel.org>
X-Original-To: lists+linux-kernel@lfdr.de
Delivered-To: lists+linux-kernel@lfdr.de
Received: from ny.mirrors.kernel.org (ny.mirrors.kernel.org [IPv6:2604:1380:45d1:ec00::1])
	by mail.lfdr.de (Postfix) with ESMTPS id 238E0A81314
	for <lists+linux-kernel@lfdr.de>; Tue,  8 Apr 2025 18:57:39 +0200 (CEST)
Received: from smtp.subspace.kernel.org (relay.kernel.org [52.25.139.140])
	(using TLSv1.2 with cipher ECDHE-ECDSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by ny.mirrors.kernel.org (Postfix) with ESMTPS id A30454E440D
	for <lists+linux-kernel@lfdr.de>; Tue,  8 Apr 2025 16:55:33 +0000 (UTC)
Received: from localhost.localdomain (localhost.localdomain [127.0.0.1])
	by smtp.subspace.kernel.org (Postfix) with ESMTP id 4DF0323645F;
	Tue,  8 Apr 2025 16:54:54 +0000 (UTC)
Authentication-Results: smtp.subspace.kernel.org;
	dkim=pass (1024-bit key) header.d=gentwo.org header.i=@gentwo.org header.b="hNZ/6BkW"
Received: from gentwo.org (gentwo.org [62.72.0.81])
	(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by smtp.subspace.kernel.org (Postfix) with ESMTPS id E056D236433
	for <linux-kernel@vger.kernel.org>; Tue,  8 Apr 2025 16:54:51 +0000 (UTC)
Authentication-Results: smtp.subspace.kernel.org; arc=none smtp.client-ip=62.72.0.81
ARC-Seal:i=1; a=rsa-sha256; d=subspace.kernel.org; s=arc-20240116;
	t=1744131293; cv=none; b=I0hRFjENusyBydfMCX/ffTUdEqfE1GIcsq9uozepFIgjNmEVSPqgaiIAQWxhefyCbJupvdtqiFHVwXZsa/NIxXzF8baR0flgQSCIr2rfnyaqC6pvLniBEqLqPTfD7gtUf8RdbgnFSb39PMwv7E13BszP8KJzh3kyzJPRfRdGN94=
ARC-Message-Signature:i=1; a=rsa-sha256; d=subspace.kernel.org;
	s=arc-20240116; t=1744131293; c=relaxed/simple;
	bh=oQX5s44vPnTDcvAxoUOmfN3MwLS+px7d6JYFjbbIzAU=;
	h=Date:From:To:cc:Subject:In-Reply-To:Message-ID:References:
	 MIME-Version:Content-Type; b=DiHvIKyQtic74tQPIpFt6u6qeNMudYqwEcWIohaVmxiO5w/N6F2jwSuRtFSJfFoz6bQ0B4ivlHZSvOsuM4QTCvt4peFYxyEBB1bhfgffDIxJjnEThOuMIt4qQSx4dhqCMWFYe+EIR3PuG73prrJ8K2zrutZ0FzTZprcW7fimHKc=
ARC-Authentication-Results:i=1; smtp.subspace.kernel.org; dmarc=pass (p=reject dis=none) header.from=gentwo.org; spf=pass smtp.mailfrom=gentwo.org; dkim=pass (1024-bit key) header.d=gentwo.org header.i=@gentwo.org header.b=hNZ/6BkW; arc=none smtp.client-ip=62.72.0.81
Authentication-Results: smtp.subspace.kernel.org; dmarc=pass (p=reject dis=none) header.from=gentwo.org
Authentication-Results: smtp.subspace.kernel.org; spf=pass smtp.mailfrom=gentwo.org
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=gentwo.org;
	s=default; t=1744130571;
	bh=oQX5s44vPnTDcvAxoUOmfN3MwLS+px7d6JYFjbbIzAU=;
	h=Date:From:To:cc:Subject:In-Reply-To:References:From;
	b=hNZ/6BkWLyNqijRRs3JbU457D69QFg+vOxfg1esAY9oWz0PDMxplFG242Wt4U1xMl
	 a8OVFYSuFEPPh1P+7138ZGcCL60utEbEcEX+clzacIPGLCJHjdZv6+kXpDruPK8dgh
	 S/padvPN+I/zIumWLk3GeFxIDwtMY7ZrLWdxyEy8=
Received: by gentwo.org (Postfix, from userid 1003)
	id 1A25F406EB; Tue,  8 Apr 2025 09:42:51 -0700 (PDT)
Received: from localhost (localhost [127.0.0.1])
	by gentwo.org (Postfix) with ESMTP id 19311401F1;
	Tue,  8 Apr 2025 09:42:51 -0700 (PDT)
Date: Tue, 8 Apr 2025 09:42:51 -0700 (PDT)
From: "Christoph Lameter (Ampere)" <cl@gentwo.org>
To: Diederik de Haas <didi.debian@cknow.org>
cc: Greg Kroah-Hartman <gregkh@linuxfoundation.org>, 
    Andrew Morton <akpm@linux-foundation.org>, 
    Thomas Gleixner <tglx@linutronix.de>, linux-kernel@vger.kernel.org, 
    Bagas Sanjaya <bagasdotme@gmail.com>, Dang Huynh <danct12@riseup.net>
Subject: Re: Is kernel/Kconfig.hz still up-to-date?
In-Reply-To: <D90FWJ3O72ML.2DA83AXPJCR3Q@cknow.org>
Message-ID: <8fc960d0-0631-a538-4956-98303776df57@gentwo.org>
References: <D90FWJ3O72ML.2DA83AXPJCR3Q@cknow.org>
Precedence: bulk
X-Mailing-List: linux-kernel@vger.kernel.org
List-Id: <linux-kernel.vger.kernel.org>
List-Subscribe: <mailto:linux-kernel+subscribe@vger.kernel.org>
List-Unsubscribe: <mailto:linux-kernel+unsubscribe@vger.kernel.org>
MIME-Version: 1.0
Content-Type: text/plain; charset=US-ASCII

On Mon, 7 Apr 2025, Diederik de Haas wrote:

> I recently had a discussion about the use of HZ_1000 in the kernel
> configuration and the impact on performance.
> My reading of the HZ_1000 help text tells me that HZ_1000 is primarily
> useful for DAW and other systems where RT capabilities are (most)
> important. This is due to "systems requiring fast interactive responses
> to events", whereby I put the emphasis on *requiring*.

Fast reponses to events can be generated by interrupts and short duration
timers even if you have a low HZ. In general we want a low HZ to reduce
system overhead.

> As *I* understand the rest of the help texts, a higher Hz value can/will
> have a negative effect on f.e. IO performance. And I'm not entirely
> sure, but it seems each CPU (core?) multiplies the nr of interrupts?

Each cpu has its own interrupts. Yes.

> While the Kconfig.hz default is still HZ_250, the x86 defconfig changed
> to HZ_1000 in 5cb04df8d3f0 ("x86: defconfig updates") (in 2008) and
> there are various distros which have switched to HZ_1000.

User land software that does not use kernel synchronization but improvises
its own spinlocks causes these issues. Sadly the desktop apps often do
this and thus benefit from a higher HZ.

> So my questions are: are the Kconfig help text still accurate for
> current (hardware) systems and kernels? Is HZ_250 still the most
> sensible default? Or is the 'newer' HZ_300 better? Or even HZ_1000?
> And does that apply only for x86 or for all architectures?
> (distros seem to vary between architectures f.e.)

HZ 100 is probably a good value. If there are regression in user space
then they are usually related to coding of spinlock functionality in user
space. Better fix user space than cause additional overhead for everyone.


