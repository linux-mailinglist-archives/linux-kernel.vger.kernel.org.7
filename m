Return-Path: <linux-kernel+bounces-773985-lists+linux-kernel=lfdr.de@vger.kernel.org>
X-Original-To: lists+linux-kernel@lfdr.de
Delivered-To: lists+linux-kernel@lfdr.de
Received: from sv.mirrors.kernel.org (sv.mirrors.kernel.org [139.178.88.99])
	by mail.lfdr.de (Postfix) with ESMTPS id CF367B2AD39
	for <lists+linux-kernel@lfdr.de>; Mon, 18 Aug 2025 17:49:26 +0200 (CEST)
Received: from smtp.subspace.kernel.org (relay.kernel.org [52.25.139.140])
	(using TLSv1.2 with cipher ECDHE-ECDSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by sv.mirrors.kernel.org (Postfix) with ESMTPS id 6E9206863FD
	for <lists+linux-kernel@lfdr.de>; Mon, 18 Aug 2025 15:44:10 +0000 (UTC)
Received: from localhost.localdomain (localhost.localdomain [127.0.0.1])
	by smtp.subspace.kernel.org (Postfix) with ESMTP id 91AA425DD1E;
	Mon, 18 Aug 2025 15:43:33 +0000 (UTC)
Authentication-Results: smtp.subspace.kernel.org;
	dkim=pass (2048-bit key) header.d=kernel.org header.i=@kernel.org header.b="OdNd+gU2"
Received: from smtp.kernel.org (aws-us-west-2-korg-mail-1.web.codeaurora.org [10.30.226.201])
	(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by smtp.subspace.kernel.org (Postfix) with ESMTPS id AF167308F13;
	Mon, 18 Aug 2025 15:43:32 +0000 (UTC)
Authentication-Results: smtp.subspace.kernel.org; arc=none smtp.client-ip=10.30.226.201
ARC-Seal:i=1; a=rsa-sha256; d=subspace.kernel.org; s=arc-20240116;
	t=1755531812; cv=none; b=QVN9KmTdNPvukCjFqm/KwSZlkA4UD5vV3WXFaob6z/eIhQZtbTfM89JwWDpbblN584FOM7znNO1a5der6ofm0z3al4dSITIF2qB29rLhUT32OnoPNcrmIJhQKJ2fwo8XpblG/2DLf6MwrB6/STDjzaf+DYAv4vdcdzIpCPbTLN4=
ARC-Message-Signature:i=1; a=rsa-sha256; d=subspace.kernel.org;
	s=arc-20240116; t=1755531812; c=relaxed/simple;
	bh=2gw9bufPdvuGnWtKJzkTzSHcYSXunQ7KQaWLcstisag=;
	h=Date:Message-ID:From:To:Cc:Subject:In-Reply-To:References:
	 MIME-Version:Content-Type; b=EJ2n+4gZFyw8MnVR7J+ayysyynWBB/czrNwD3PPOFwjukhPSCBI9yn8pejDy709hG+jv+7+WCdtrpcfGBu/Zo2p/BeZ5qlzacbGVFWEaw0vQH35rjvJ6ZUoxkDfFcDxN5rzOy1EI5BzYjHOjpnBgki0qlSSHvNsKVUSJLhpsx58=
ARC-Authentication-Results:i=1; smtp.subspace.kernel.org; dkim=pass (2048-bit key) header.d=kernel.org header.i=@kernel.org header.b=OdNd+gU2; arc=none smtp.client-ip=10.30.226.201
Received: by smtp.kernel.org (Postfix) with ESMTPSA id 39E6FC4CEEB;
	Mon, 18 Aug 2025 15:43:32 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=kernel.org;
	s=k20201202; t=1755531812;
	bh=2gw9bufPdvuGnWtKJzkTzSHcYSXunQ7KQaWLcstisag=;
	h=Date:From:To:Cc:Subject:In-Reply-To:References:From;
	b=OdNd+gU2RzCHnheu7QHypV85qYdEmzkXGbMRwN4Ud74Gu7537V/ABBSmlTU32xpAW
	 R+Y49WjaELw1uuf9aIRhtJ1LpMFcuNqTVDVIGWs/eU4iaX8tP7vlcSv8mTJIFjnVs5
	 M/+zJhzPrK05V/89tT/liw3X3Rr/PMVRpmU0lKchrSlqoQ01p+Ij0eF7WNMq0CNVrk
	 iQ0t+WqUw42wFZ0JTwzDDPBPGWbcqH5vYCB/Dx7vKVFUjY9QkFRWtI60nzOpHf/f21
	 KIpf2zswgKLuI8VJqxBOqByd9GCOi33UgxPXKWj8tXZUlLvxxl3kbsar25O0XVgGFk
	 343glz0N3v44A==
Received: from host86-149-246-145.range86-149.btcentralplus.com ([86.149.246.145] helo=lobster-girl.misterjones.org)
	by disco-boy.misterjones.org with esmtpsa  (TLS1.3) tls TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
	(Exim 4.95)
	(envelope-from <maz@kernel.org>)
	id 1uo218-008fTF-Hr;
	Mon, 18 Aug 2025 16:43:26 +0100
Date: Mon, 18 Aug 2025 16:43:06 +0100
Message-ID: <87ldngmy9h.wl-maz@kernel.org>
From: Marc Zyngier <maz@kernel.org>
To: Anshuman Khandual <anshuman.khandual@arm.com>
Cc: linux-arm-kernel@lists.infradead.org,
	Catalin Marinas <catalin.marinas@arm.com>,
	Will Deacon <will@kernel.org>,
	Oliver Upton <oliver.upton@linux.dev>,
	Mark Brown <broonie@kernel.org>,
	Ryan Roberts <ryan.roberts@arm.com>,
	kvmarm@lists.linux.dev,
	linux-kernel@vger.kernel.org
Subject: Re: [PATCH 3/4] arm64/sysreg: Add TCR_EL2 register
In-Reply-To: <20250818045759.672408-4-anshuman.khandual@arm.com>
References: <20250818045759.672408-1-anshuman.khandual@arm.com>
	<20250818045759.672408-4-anshuman.khandual@arm.com>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI-EPG/1.14.7 (Harue)
 FLIM-LB/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL-LB/10.8 EasyPG/1.0.0 Emacs/30.1
 (aarch64-unknown-linux-gnu) MULE/6.0 (HANACHIRUSATO)
Precedence: bulk
X-Mailing-List: linux-kernel@vger.kernel.org
List-Id: <linux-kernel.vger.kernel.org>
List-Subscribe: <mailto:linux-kernel+subscribe@vger.kernel.org>
List-Unsubscribe: <mailto:linux-kernel+unsubscribe@vger.kernel.org>
MIME-Version: 1.0 (generated by SEMI-EPG 1.14.7 - "Harue")
Content-Type: text/plain; charset=US-ASCII
X-SA-Exim-Connect-IP: 86.149.246.145
X-SA-Exim-Rcpt-To: anshuman.khandual@arm.com, linux-arm-kernel@lists.infradead.org, catalin.marinas@arm.com, will@kernel.org, oliver.upton@linux.dev, broonie@kernel.org, ryan.roberts@arm.com, kvmarm@lists.linux.dev, linux-kernel@vger.kernel.org
X-SA-Exim-Mail-From: maz@kernel.org
X-SA-Exim-Scanned: No (on disco-boy.misterjones.org); SAEximRunCond expanded to false

On Mon, 18 Aug 2025 05:57:58 +0100,
Anshuman Khandual <anshuman.khandual@arm.com> wrote:
> 
> Add TCR_EL2 register fields as per the latest ARM ARM DDI 0487 7.B in tools

7.B??? My copy of the published ARM ARM has L.B as the version suffix.

Also, if you got the registers from the ARM ARM, please stop doing
so. This is terribly error prone, and likely to be incomplete, given
that the ARM ARM lags about a year behind the published architecture.

You have the BSD-licensed MRS at your disposal, please make use of it.

> sysreg format and drop all the existing redundant macros from the header
> (arch/arm64/include/asm/kvm_arm.h). While here also drop an explicit sysreg
> definction SYS_TCR_EL2 from sysreg.h header.
> 
> Cc: Catalin Marinas <catalin.marinas@arm.com>
> Cc: Will Deacon <will@kernel.org>
> Cc: Marc Zyngier <maz@kernel.org>
> Cc: Oliver Upton <oliver.upton@linux.dev>
> Cc: Mark Brown <broonie@kernel.org>
> Cc: linux-arm-kernel@lists.infradead.org
> Cc: kvmarm@lists.linux.dev
> Cc: linux-kernel@vger.kernel.org
> Signed-off-by: Anshuman Khandual <anshuman.khandual@arm.com>
> ---
>  arch/arm64/include/asm/kvm_arm.h | 13 ----------
>  arch/arm64/include/asm/sysreg.h  |  1 -
>  arch/arm64/tools/sysreg          | 44 ++++++++++++++++++++++++++++++++
>  3 files changed, 44 insertions(+), 14 deletions(-)
> 
> diff --git a/arch/arm64/include/asm/kvm_arm.h b/arch/arm64/include/asm/kvm_arm.h
> index 560d9cb63413..8994cddef182 100644
> --- a/arch/arm64/include/asm/kvm_arm.h
> +++ b/arch/arm64/include/asm/kvm_arm.h
> @@ -107,19 +107,6 @@
>  
>  #define MPAMHCR_HOST_FLAGS	0
>  
> -/* TCR_EL2 Registers bits */
> -#define TCR_EL2_DS		(1UL << 32)
> -#define TCR_EL2_RES1		((1U << 31) | (1 << 23))
> -#define TCR_EL2_HPD		(1 << 24)
> -#define TCR_EL2_TBI		(1 << 20)
> -#define TCR_EL2_PS_SHIFT	16
> -#define TCR_EL2_PS_MASK		(7 << TCR_EL2_PS_SHIFT)
> -#define TCR_EL2_PS_40B		(2 << TCR_EL2_PS_SHIFT)
> -#define TCR_EL2_TG0_MASK	TCR_EL1_TG0_MASK
> -#define TCR_EL2_SH0_MASK	TCR_EL1_SH0_MASK
> -#define TCR_EL2_ORGN0_MASK	TCR_EL1_ORGN0_MASK
> -#define TCR_EL2_IRGN0_MASK	TCR_EL1_IRGN0_MASK
> -#define TCR_EL2_T0SZ_MASK	0x3f
>  #define TCR_EL2_MASK	(TCR_EL2_TG0_MASK | TCR_EL2_SH0_MASK | \
>  			 TCR_EL2_ORGN0_MASK | TCR_EL2_IRGN0_MASK)
>  
> diff --git a/arch/arm64/include/asm/sysreg.h b/arch/arm64/include/asm/sysreg.h
> index ad5c901af229..112d5d0acb50 100644
> --- a/arch/arm64/include/asm/sysreg.h
> +++ b/arch/arm64/include/asm/sysreg.h
> @@ -523,7 +523,6 @@
>  
>  #define SYS_TTBR0_EL2			sys_reg(3, 4, 2, 0, 0)
>  #define SYS_TTBR1_EL2			sys_reg(3, 4, 2, 0, 1)
> -#define SYS_TCR_EL2			sys_reg(3, 4, 2, 0, 2)
>  #define SYS_VTTBR_EL2			sys_reg(3, 4, 2, 1, 0)
>  #define SYS_VTCR_EL2			sys_reg(3, 4, 2, 1, 2)
>  
> diff --git a/arch/arm64/tools/sysreg b/arch/arm64/tools/sysreg
> index 4bdae8bb11dc..d2b40105eb41 100644
> --- a/arch/arm64/tools/sysreg
> +++ b/arch/arm64/tools/sysreg
> @@ -4812,6 +4812,50 @@ Sysreg	TCR_EL12        3	5	2	0	2
>  Mapping	TCR_EL1
>  EndSysreg
>  
> +Sysreg	TCR_EL2        3	4	2	0	2
> +Res0	63:34
> +Field	33	MTX
> +Field	32	DS
> +Res1	31
> +Field	30	TCMA
> +Field	29	TBID
> +Field	28	HWU62
> +Field	27	HWU61
> +Field	26	HWU60
> +Field	25	HWU59
> +Field	24	HPD
> +Res1	23
> +Field	22	HD
> +Field	21	HA
> +Field	20	TBI
> +Res0	19
> +Field   18:16	PS
> +UnsignedEnum	15:14	TG0
> +	0b00	4K
> +	0b01	64K
> +	0b10	16K
> +EndEnum
> +UnsignedEnum	13:12	SH0
> +	0b00	NONE
> +	0b10	OUTER
> +	0b11	INNER
> +EndEnum
> +UnsignedEnum	11:10	ORGN0
> +	0b00	NC
> +	0b01	WBWA
> +	0b10	WT
> +	0b11	WBnWA
> +EndEnum
> +UnsignedEnum	9:8	IRGN0
> +	0b00	NC
> +	0b01	WBWA
> +	0b10	WT
> +	0b11	WBnWA
> +EndEnum
> +Res0    7:6
> +Field   5:0	T0SZ
> +EndSysreg

This is only the E2H==0 version of TCR_EL2. IF you are going to
describe this register in a useful manner, then add both formats so
that we know what we are dealing with.

	M.

-- 
Jazz isn't dead. It just smells funny.

